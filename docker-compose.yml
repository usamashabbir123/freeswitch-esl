version: '3.8'

services:
  freeswitch-logger:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: freeswitch-logger
    restart: unless-stopped

    env_file:
      - .env

    environment:
      - ESL_HOST=${ESL_HOST}
      - ESL_PORT=${ESL_PORT}
      - ESL_PASSWORD=${ESL_PASSWORD}
      - LOG_DIR=${LOG_DIR}
      - LOG_LEVEL=${LOG_LEVEL}
      - RECONNECT_DELAY=${RECONNECT_DELAY}
      - FILE_ROTATION_SIZE=${FILE_ROTATION_SIZE}
      - BUFFER_FLUSH_INTERVAL=${BUFFER_FLUSH_INTERVAL}

    volumes:
      # store logs persistently on host
      - ${HOST_LOG_PATH}:/var/log/freeswitch

    network_mode: host

    healthcheck:
      test: ["CMD", "python3", "-c", "import os; exit(0 if os.path.exists('/var/log/freeswitch-logs') else 1)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
